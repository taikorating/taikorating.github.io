<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªé¼“ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒƒãƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&display=swap" rel="stylesheet">
    <style>
        /* --- åŸºæœ¬ãƒªã‚»ãƒƒãƒˆ --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'M PLUS Rounded 1c', "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #fce4d6;
            background-image: radial-gradient(#ffccbc 10%, transparent 10%);
            background-size: 20px 20px;
            color: #333;
            overflow-y: auto;
            min-height: 100vh;
        }

        /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ --- */
        .game-container {
            background: #fff;
            padding: 20px;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            margin: 0 auto;
            height: auto; 
        }

        .game-container.pc-mode {
            width: 100%;
            max-width: 500px;
            min-height: 800px;
            margin-top: 40px;
            margin-bottom: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border: 4px solid #ff5722;
        }

        .game-container.mobile-mode {
            width: 100%;
            min-height: 100vh;
            border: none;
            border-radius: 0;
            box-shadow: none;
        }

        /* --- å…±é€šãƒ‘ãƒ¼ãƒ„ --- */
        h1, h2, h3 { font-weight: 800; }
        .title-logo { font-size: 2.2rem; color: #ff5722; text-shadow: 2px 2px 0px #ffe0b2; margin-bottom: 5px; }
        .sub-title { color: #f57c00; font-weight: bold; margin-bottom: 20px; font-size: 0.9rem; }
        
        button { font-family: inherit; outline: none; }
        .btn { border: none; padding: 12px; border-radius: 10px; cursor: pointer; transition: 0.1s; width: 100%; font-weight: bold; color: white; margin-bottom: 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); position: relative; top: 0;}
        .btn:active { top: 3px; box-shadow: 0 1px 0 rgba(0,0,0,0.1); }
        .btn-orange { background: #ff5722; }
        .btn-blue { background: #2196f3; }
        .btn-green { background: #4caf50; }
        .btn-gray { background: #757575; }
        .btn-red { background: #d32f2f; }
        
        .view-toggle-box {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }
        .view-btn {
            background: transparent; border: 2px solid #aaa; color: #555;
            padding: 5px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; margin: 0 5px;
        }
        .view-btn.active { background: #555; color: white; border-color: #555; }

        .login-btn-group { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn-google { background: #db4437; }
        .btn-x { background: #000; }
        .btn-email { background: #607d8b; }
        
        .profile-bar {
            background: #333; color: white; padding: 10px 15px; border-radius: 12px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; box-shadow: 0 4px 0 #000;
        }
        .profile-name { font-size: 0.9rem; text-align: left; }
        .profile-rate { color: #ffd700; font-size: 1.1rem; }
        .settings-icon { cursor: pointer; font-size: 1.2rem; }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .menu-btn { height: 80px; font-size: 1rem; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        .rank-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .rank-table th { background: #ffccbc; padding: 8px; color: #d84315; }
        .rank-table td { border-bottom: 1px solid #eee; padding: 8px; }
        .rank-1 { color: #d4af37; font-weight: bold; font-size: 1.1rem; }
        .rank-2 { color: #a0a0a0; font-weight: bold; }
        .rank-3 { color: #cd7f32; font-weight: bold; }

        .screen { display: none; width: 100%; flex-direction: column; align-items: center; flex: 1; }
        .screen.active { display: flex; }
        .center-content { justify-content: center; }

        .scrollable-content { width: 100%; overflow-y: auto; flex: 1; margin-bottom: 20px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-box { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.3); animation: popIn 0.3s; }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .input-field { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px; font-size: 1rem; }
        .input-label { display: block; text-align: left; font-weight: bold; margin-bottom: 5px; font-size: 0.8rem; color: #555; }
        .loader { border: 6px solid #f3f3f3; border-top: 6px solid #ff5722; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .rate-diff { font-size: 1.5rem; opacity: 0; transition: 0.5s; display: block; height: 30px; }
        .rate-diff.show { opacity: 1; transform: translateY(-5px); }
        .song-list-box { text-align: left; margin: 10px 0; padding-left: 20px; font-weight: bold; color: #555; font-size: 0.9rem;}
        .song-list-item { margin-bottom: 5px; }
        .instruction-box { background: #e3f2fd; border: 2px solid #2196f3; padding: 10px; border-radius: 8px; font-size: 0.85rem; color: #0d47a1; margin-bottom: 15px; text-align: left; }
    </style>
</head>
<body>

    <div id="main-container" class="game-container mobile-mode">
        
        <div id="login-screen" class="screen active center-content">
            <h1 class="title-logo">DON-DER MATCH</h1>
            <p class="sub-title">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å¯¾æˆ¦ã‚’å§‹ã‚ã‚ˆã†</p>
            <div class="login-btn-group" style="width: 100%;">
                <button class="btn btn-google" onclick="loginWithGoogle()">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button class="btn btn-x" onclick="alert('Xãƒ­ã‚°ã‚¤ãƒ³ã«ã¯APIè¨­å®šãŒå¿…è¦ã§ã™')">X (Twitter) ã§ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div style="display:flex; gap:5px;">
                    <input type="email" id="email-input" class="input-field" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" style="margin:0;">
                    <input type="password" id="pass-input" class="input-field" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" style="margin:0;">
                </div>
                <div style="display:flex; gap:5px;">
                    <button class="btn btn-email" onclick="loginWithEmail()">ç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³</button>
                </div>
                <button class="btn btn-gray" onclick="loginAnon()">åŒ¿åã§å§‹ã‚ã‚‹</button>
            </div>
            <div class="view-toggle-box">
                <p style="font-size:0.8rem; margin-bottom:10px;">è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ</p>
                <button class="view-btn active" id="btn-mobile" onclick="setViewMode('mobile')">ã‚¹ãƒãƒ›ç‰ˆ</button>
                <button class="view-btn" id="btn-pc" onclick="setViewMode('pc')">PCç‰ˆ</button>
            </div>
        </div>

        <div id="title-screen" class="screen">
            <h1 class="title-logo">DON-DER MATCH</h1>
            <div class="profile-bar">
                <div>
                    <div class="profile-name" id="display-name">Loading...</div>
                    <div style="font-size:0.8rem; opacity:0.8;" id="display-xid">@æœªè¨­å®š</div>
                </div>
                <div style="text-align:right;">
                    <div class="profile-rate">Rate: <span id="display-rate">---</span></div>
                    <span class="settings-icon" onclick="openProfileModal()">âš™ï¸è¨­å®š</span>
                </div>
            </div>
            <div class="menu-grid">
                <button class="btn btn-orange menu-btn" onclick="openRanking()"><span>ğŸ†</span>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
                <button class="btn btn-blue menu-btn" onclick="alert('å±¥æ­´æ©Ÿèƒ½ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“')"><span>ğŸ“œ</span>å¯¾æˆ¦å±¥æ­´</button>
            </div>
            <p style="font-weight:bold; margin-bottom:10px;">å¯¾æˆ¦é›£æ˜“åº¦ã‚’é¸æŠ</p>
            <button class="btn btn-green" onclick="tryStartMatching('normal')">é›£æ˜“åº¦ F ï½ A+</button>
            <button class="btn btn-orange" onclick="tryStartMatching('hard')">é›£æ˜“åº¦ S ï½ SS</button>
        </div>

        <div id="matching-screen" class="screen center-content">
            <div class="loader"></div>
            <h3>å¯¾æˆ¦ç›¸æ‰‹ã‚’æ¢ã—ã¦ã„ã¾ã™...</h3>
            <p id="match-status" style="color:#ff5722; margin-top:10px; font-weight:bold;"></p>
            <p style="font-size:0.8rem; color:#777; margin-top:5px;">â€»15ç§’çµŒéã™ã‚‹ã¨è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã™</p>
            <button class="btn btn-gray" style="margin-top:30px; width:50%;" onclick="cancelMatching()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div id="reveal-screen" class="screen" style="padding-top:20px;">
            <h2 style="color:#ff5722;">MATCH START!</h2>
            <p>VS å¯¾æˆ¦ç›¸æ‰‹</p>
            <div style="font-size:1.5rem; font-weight:bold; color:#1da1f2; border:2px solid #1da1f2; padding:10px; border-radius:10px; margin:10px 0;">
                <span id="opponent-x-display"></span>
            </div>
            <div id="song-reveal-container" style="width:100%; margin-top:10px; flex:1;"></div>
            <button id="goto-report-btn" class="btn btn-green" style="display:none; margin-top:20px; margin-bottom:20px;" onclick="goToReportScreen()">çµæœã‚’å ±å‘Šã™ã‚‹</button>
        </div>

        <div id="report-screen" class="screen center-content" style="justify-content: flex-start; padding-top: 20px;">
            <h2>çµæœå ±å‘Š</h2>
            <div class="scrollable-content">
                <div class="instruction-box">
                    <strong>ã€å¯¾æˆ¦æ‰‹é †ã€‘</strong><br>
                    1. X IDå®›ã«DMç­‰ã§ãƒªã‚¶ãƒ«ãƒˆã‚’äº¤æ›<br>
                    2. 3æ›²ã®è‰¯ã®åˆè¨ˆæ•°ã‚’æ¯”è¼ƒ<br>
                    3. çµæœï¼ˆå‹ã¡ãƒ»è² ã‘ï¼‰ã‚’ç”³å‘Š<br><br>
                    <span style="color:#d32f2f; font-size:0.8rem;">â€»ã‚¢ãƒ—ãƒªåˆ‡æ›¿ç­‰ã§é€šä¿¡ãŒé€”åˆ‡ã‚Œã¦ã‚‚ã€<br>13åˆ†é–“ã¯æ¥ç¶šã‚’ç¶­æŒã—ã¾ã™ã€‚</span>
                </div>
                <div style="background:#f5f5f5; padding:15px; border-radius:10px; width:100%; text-align:left;">
                    <p><strong>ç›¸æ‰‹:</strong> <span id="rep-opp-name" style="font-weight:bold;"></span></p>
                    <p><strong>X ID:</strong> <span id="rep-opp-xid" style="color:#1da1f2; font-weight:bold;"></span></p>
                    <hr style="margin:10px 0; border:none; border-top:1px solid #ddd;">
                    <p><strong>â–¼ èª²é¡Œæ›²ãƒªã‚¹ãƒˆ</strong></p>
                    <div id="rep-song-list" class="song-list-box"></div>
                </div>
            </div>

            <p style="font-weight:bold; margin-bottom:10px;">ã‚ãªãŸã®å‹æ•—ã¯ï¼Ÿ</p>
            <div style="display:flex; gap:10px; width:100%; margin-bottom:20px;">
                <button class="btn" style="background:#e91e63;" onclick="confirmResult('WIN')">å‹ã¡</button>
                <button class="btn" style="background:#9c27b0;" onclick="confirmResult('DRAW')">å¼•åˆ†</button>
                <button class="btn" style="background:#2196f3;" onclick="confirmResult('LOSE')">è² ã‘</button>
            </div>
            
            <button class="btn btn-red" style="margin-bottom:20px;" onclick="tryExitRoom()">é€€å‡ºã™ã‚‹ (ç„¡åŠ¹è©¦åˆ)</button>
        </div>

        <div id="waiting-result-screen" class="screen center-content">
            <div class="loader"></div>
            <h3>ç¢ºèªä¸­...</h3>
            <p>ç›¸æ‰‹ã®å…¥åŠ›ã‚’å¾…ã£ã¦ã„ã¾ã™</p>
            <p style="font-size:0.8rem; color:red; margin-top:20px;">â€»13åˆ†ä»¥ä¸Šå¿œç­”ãŒãªã„å ´åˆã€<br>è‡ªå‹•ã§ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šçµ‚äº†ã—ã¾ã™ã€‚</p>
            
            <button class="btn btn-red" style="margin-top:30px; width: auto; padding-left: 30px; padding-right: 30px;" onclick="tryExitRoom()">é€€å‡ºã™ã‚‹ (ç„¡åŠ¹è©¦åˆ)</button>
        </div>

        <div id="final-result-screen" class="screen center-content">
            <h1 id="final-title" style="font-size:3rem; margin-bottom:10px;">WIN!</h1>
            <div style="margin:20px 0;">
                <div style="font-size:3rem; font-weight:900;" id="anim-rate-val">1500</div>
                <div class="rate-diff" id="anim-rate-diff">+20</div>
            </div>
            <button class="btn btn-gray" onclick="returnToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="profile-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h3>
            <div style="margin-top:20px;">
                <label class="input-label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label>
                <input type="text" id="edit-name" class="input-field" placeholder="ä¾‹: ã©ã‚“ã¡ã‚ƒã‚“">
                <label class="input-label">X(Twitter) ID</label>
                <p style="font-size:0.7rem; color:#e91e63; text-align:left;">â€»å¯¾æˆ¦ã«ã¯å…ˆé ­ã« @ ãŒå¿…è¦ã§ã™</p>
                <input type="text" id="edit-xid" class="input-field" placeholder="ä¾‹: @taiko_master">
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-gray" onclick="closeModal('profile-modal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-orange" onclick="saveProfile()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <div id="ranking-modal" class="modal-overlay">
        <div class="modal-box" style="max-width:450px;">
            <h3>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
            <div style="max-height:300px; overflow-y:auto;">
                <table class="rank-table">
                    <thead><tr><th>é †ä½</th><th>åå‰</th><th>ãƒ¬ãƒ¼ãƒˆ</th></tr></thead>
                    <tbody id="ranking-list"></tbody>
                </table>
            </div>
            <button class="btn btn-gray" style="margin-top:20px;" onclick="closeModal('ranking-modal')">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>ç¢ºèª</h3>
            <p style="margin:15px 0;">çµæœã¯ã€Œ<span id="modal-selection" style="font-weight:bold; color:#ff5722;"></span>ã€ã§<br>é–“é•ã„ãªã„ã§ã™ã‹ï¼Ÿ</p>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-gray" onclick="closeModal('confirm-modal')">æˆ»ã‚‹</button>
                <button class="btn btn-orange" onclick="submitResult()">æ±ºå®š</button>
            </div>
        </div>
    </div>

    <div id="error-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:#d32f2f;">çµæœä¸ä¸€è‡´</h3>
            <p>ç”³å‘ŠãŒé£Ÿã„é•ã£ã¦ã„ã¾ã™ã€‚<br>ã‚‚ã†ä¸€åº¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
            <button class="btn btn-orange" onclick="retryReport()">å†å…¥åŠ›</button>
        </div>
    </div>

    <div id="exit-confirm-modal-1" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:#d32f2f;">è­¦å‘Š</h3>
            <p>é€€å‡ºã™ã‚‹ã¨ç„¡åŠ¹è©¦åˆã«ãªã‚Šã¾ã™ã€‚<br>æœ¬å½“ã«é€€å‡ºã—ã¾ã™ã‹ï¼Ÿ</p>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn btn-gray" onclick="closeModal('exit-confirm-modal-1')">ã‚„ã‚ã‚‹</button>
                <button class="btn btn-red" onclick="showExitConfirm2()">ã¯ã„</button>
            </div>
        </div>
    </div>
    <div id="exit-confirm-modal-2" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:#d32f2f;">æœ€çµ‚ç¢ºèª</h3>
            <p>æœ¬å½“ã«é€€å‡ºã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ<br>(ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“)</p>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn btn-gray" onclick="closeModal('exit-confirm-modal-2')">ã‚„ã‚ã‚‹</button>
                <button class="btn btn-red" onclick="forceExitRoom()">é€€å‡ºã™ã‚‹</button>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot, deleteDoc, doc, updateDoc, limit, getDoc, setDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // â˜…â˜…â˜… APIã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â˜…â˜…â˜…
        const firebaseConfig = {
  apiKey: "AIzaSyBU1LAF6ceIsezKarsiecSTbH87Cb3gnTw",
  authDomain: "taikorating.firebaseapp.com",
  projectId: "taikorating",
  storageBucket: "taikorating.firebasestorage.app",
  messagingSenderId: "657970223088",
  appId: "1:657970223088:web:509230d6b20d78cbf3af35",
  measurementId: "G-PJXEXL5E9M"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let userData = { displayName: "åç„¡ã—", xId: "æœªè¨­å®š", rate: 1500 }; 
        let waitingDocId = null;
        let currentRoomId = null;
        let unsubscribeRoom = null;
        let currentMatchData = {};
        let selectedResult = null;
        let isFinalizing = false;
        let matchTimer = null;
        let heartbeatTimer = null;
        let wakeLock = null; 

        const songDatabase = {
           'normal': [
                "ã‚¢ãƒ ãƒ”ãƒˆâ—‡ãƒªãƒ¼ãƒ†ãƒ¼","ouroboros -twin stroke of the end-","Ï‡è«‡","ã‚«ãƒ©ãƒ•ãƒ«","å½¼ã¯èª°æ™‚ã®èª˜æƒ‘ï¼ˆè£ï¼‰","ã‚³ã‚³ãƒ‰ã‚³ï¼Ÿå¤šåˆ†ãƒ‰ãƒƒã‚«å³¶ï¼ï¼ˆè£ï¼‰","ã‚³ãƒã‚¯ãƒˆã‚«ãƒ©ãƒ¼ã‚º","GORI Ã— GORI Ã— SafaRIï¼ˆè£ï¼‰","ä¸‡æˆˆã‚¤ãƒ ï¼ä¸€ãƒå","é’å¤©ã®é»æ˜","Central Dogma Pt.2","Taiko Drum Monsterï¼ˆè¡¨ï¼‰","DEBSTEP!","Dreadnoughtï¼ˆè£ï¼‰","Don't Stop the Game","HARDCOREãƒå¿ƒå¾—","å¹•æœ«ç¶­æ–°è­š","â€ ãƒãƒ!ãƒ ãƒ!?ãƒãƒƒã‚¹ãƒ«ã‚­ãƒ³ã‚°ãƒ€ãƒ â€ ","Hello, Worldooon!!ï¼ˆè£ï¼‰","ãƒ‘ãƒ³ vs ã”ã¯ã‚“ï¼ å¤§æ±ºæˆ¦ï¼ï¼ˆè£ï¼‰[é”äºº]","ãƒ”ãƒƒãƒãƒ•ã‚§ã‚¤ãƒ€ï¼ˆè£ï¼‰","for Qï¼ˆè£ï¼‰","ãƒ—ãƒãƒãƒ","Behemoth","ã¾ã‚‹ãã¦ã¯ã‚„ãã¦ã™ã•ã¾ã˜ã„ãƒªã‚ºãƒ ","ãƒ¢ãƒã‚¯ãƒ­ãƒ¼ãƒ ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢","ãƒ©ãƒ‘ã‚¹ã®è™¹ï¼ˆè£ï¼‰","èµ¤ã¨ç™½è–”è–‡ã®é­”å¥³","ã‚ã‚ãµã‚Šã®ãƒ­ãƒ³ãƒ‰ï¼ˆè£ï¼‰","ON SAY GO SAYï¼ˆè£ï¼‰","ã‚«ãƒ«ãƒ¡ãƒ³çµ„æ›² ä¸€ç•ªçµ‚æ›²ï¼ˆè£ï¼‰","æ£®ç¾…ä¸‡è±¡[é–‹å¹•é”äºº]","åŒç«œãƒä¹±ï¼ˆè£ï¼‰ã€åŒæ‰“ã€‘","ãƒ‡ãƒƒãƒ‰ãƒ»ã‚ªã‚¢ãƒ»ãƒ€ã‚¤","23æ™‚54åˆ†ã€é™½ã®æ—…è·¯ã¸ã®ãƒ—ãƒ¬ãƒªãƒ¥ãƒ¼ãƒ‰ï¼ˆè¡¨ï¼‰","ã«ã‚ƒãƒ¼ã«ã‚ƒãƒ¼ã«ã‚ƒãƒ¼","ãƒ¡ã‚¿ãƒŠã‚¤ãƒˆã®é€†è¥²ãƒ¡ãƒ‰ãƒ¬ãƒ¼ï¼ˆè£ï¼‰","8OROCHIï¼ˆè£ï¼‰","å“€ want U","è’¼é·ºä¹‹ç«ï¼ˆè£ï¼‰","æˆ–ãƒ«ä¸å’Œ","VERTeX","ç¾ã—ãå¿™ã—ããƒ‰ãƒŠã‚¦ï¼ˆè£ï¼‰","ã‚¦ãƒ«ãƒˆãƒ©ãƒãƒ³Xï¼ˆè£ï¼‰","éƒ¢æ›²ï¼æšé—‡","Agent Hustle & Dr. Hassleï¼ˆè¡¨ï¼‰","GERBERA","é›²é–“ã‚’æ¸¸ã","The Future of the å¤ªé¼“ãƒ‰ãƒ©ãƒ ï¼ˆè¡¨ï¼‰","SAVAGE DELIGHT","ã€†ãƒ‰ãƒ¬ãƒ¼2000","é‡é‡‘å±ãƒ•ãƒ¥ãƒ¼ã‚®ãƒ†ã‚£ãƒ–","Xevel","å…¶æ–¹ã€æ¿€æ˜‚","è¶…çµ¶æŠ€å·§ç³»å°‘å¥³","ãƒ†ãƒˆãƒ©ãƒªãƒ¥ãƒˆãƒ¢ã‚¹ãƒ•ã‚©ãƒ“ã‚¢","å¤©æ³£ã®å¾‹","è»¢ç”Ÿã€ˆTENSEIã€‰-å–œä¸å¿—ãŒå¾…ã¤å¼·è€…-ï¼ˆè£ï¼‰","Toon Town's Toys' Tune","ãƒŠã‚¤ãƒˆãƒ¡ã‚¢ãƒ»ã‚µãƒã‚¤ãƒãƒ¼ï¼ˆè£ï¼‰","BATTLE NO.1[é”äºº]","Honey Heartbeat ï½10 Stars Mixï½ï¼ˆè£ï¼‰","Parousia","ãƒ‘ãƒ³ vs ã”ã¯ã‚“ï¼ å¤§æ±ºæˆ¦ï¼ï¼ˆè¡¨ï¼‰[é”äºº]","vs.VIGVANGSï¼ˆè¡¨ï¼‰","Mood Swingï¼ˆè£ï¼‰","ã‚‚ãºã‚‚ãº","èºæ—‹å‘¨å›è»Œé“ï¼ˆè£ï¼‰","LECIEL GLISSANDO","LUNATiC CiRCUiT","å†·å‡åº«CJ ï½å—šå‘¼é¢å¤ªé¼“ãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºï½","ARMAGEÎ”DON","Unwelcome School (MRM REMIX)ï¼ˆè£ï¼‰","Irregular Clockï¼ˆè£ï¼‰","EterNal Ring","æ‡ä¸­åº­åœ’ã‚’æŒã¤å°‘å¥³","çµ¡ç¹°å»»å»Š","Caribbean Knight","GIGALODOONï¼ˆè£ï¼‰","é¼“ç«‹ã‚ãŠã¯ã‚‹å­¦åœ’æ ¡æ­Œ","æŸã­ç³¸","ãƒãƒ«ãƒã®ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã•ã‚“ã™ã†æ•™å®¤âˆå‘¨å¹´ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆè£ï¼‰","å„šå§«ã¯åŸåˆã«èˆã†ï¼ˆè£ï¼‰","ã²ã‚ˆã“é‘‘å®šå£«ã•ã‚“","FLOWERï¼ˆè£ï¼‰","BLAZING VORTEXï¼ˆè£ï¼‰","Player's High","ANiMA","Altaleï¼ˆè£ï¼‰","Aleph-0","UNDEAD HEART(æ€’ã‚Šã®Warriors)","ã‚¤ã‚ªã‚·ã‚¹ç§‹ã®çˆ†é£Ÿç¥­2024","æ€’æ§Œ","Valsqotch","OK Iâ€™m blue rat","KAGEKIYOï¼ˆè£ï¼‰","CUT! into the FUTUREï¼ˆè¡¨ï¼‰","æ¥µåœ","æ²“ã®å­ã‚’æ‰“ã¤ï¼ˆè£ï¼‰","ã‚¯ãƒ©ãƒãƒ«ãƒãƒ«ã‚¹ã‚«","Groovy Duel","Goldfish City","Got more raves?ï¼ˆè£ï¼‰","ç§‹ç«œ ï½Shiuryuï½ï¼ˆè£ï¼‰","ç–¾é¢¨æ€’æ¿¤ï¼ˆè¡¨ï¼‰","æ‰¿èªæ¬²Q","Singularity Game","æ™¨æ˜Ÿãƒˆéµº","SUPERNOVAï¼ˆè£ï¼‰","Stick Trick ShowTime!!","é–ƒå…‰å¤©èˆ","SoulStone -é—‡å–°ã‚¤ã‚µã‚¡ã‚«ã‚¹å›£-","SORA-VII ã‚·ã‚°ãƒŠã‚¹ã‚¦ã‚©ãƒ¼ãƒ«","æœˆèª­å‘½","é›»è„³å¹»å¤œã®æ˜Ÿè¨€è© ","ãƒˆã‚¤ãƒãƒãƒƒã‚¯â˜†ãƒ‘ãƒ¬ãƒ¼ãƒ‰!!","Doom Noiz","Hello, Mr.JOKER","äººã®ãŠé‡‘ã§ç„¼è‚‰ã‚’é£Ÿã—ãŸã„ï¼ï¼ˆè£ï¼‰","FUJIN Rumble","Help me, ã•ã„ãŸã¾2000!!","ã¾ãŸã•ã„ãŸã¾2000","ä¸‰ç€¬å·ä¹±èˆï¼ˆè£ï¼‰","ãƒ¡ã‚«ãƒ‡ã‚¹ã€‚ï¼ˆè£ï¼‰","ã‚ãŸã‚ãŸâ˜†ã‚†ã«ã°ï½ã™ã£ï¼ï¼ˆè£ï¼‰","ãƒ¢ãƒã‚¯ãƒ­ãƒœã‚¤ã‚¹ï¼ˆè¡¨ï¼‰","Reï¼šEnd of a Dreamï¼ˆè£ï¼‰","ç«œã¨é»’ç‚ã®å§«å›ï¼ˆè£ï¼‰","ç·´ç¿’æ›²Op.10-4ï¼ˆè£ï¼‰","Rotter Tarminationï¼ˆè£ï¼‰","å…­æœ¬ã®è–”è–‡ã¨é‡‡ã®æ­Œï¼ˆè£ï¼‰","What's in the box?","ã‚ãªãŸã¨ãƒˆã‚¥ãƒ©ãƒƒã‚¿ãƒƒã‚¿â™ªï¼ˆè£ï¼‰","Aragami","æ¡ˆå±±å­å§« -Princess Scarecrow-ï¼ˆè£ï¼‰","Garakuta Doll Playï¼ˆè£ï¼‰","ã‚«ãƒ©ãƒ•ãƒ«ãƒœã‚¤ã‚¹ï¼ˆè£ï¼‰","Calculator","æ°—ç„”ä¸‡ä¸ˆç¥æ¥½","Kill My Fortuneï¼ˆè£ï¼‰","ã‚²ã‚²ã‚²ã®é¬¼å¤ªéƒï¼ˆè£ï¼‰","åˆ»ç«œ ï½Kokuryuï½ï¼ˆè¡¨ï¼‰","ç¥ç«œ ï½Shinryuï½ï¼ˆè¡¨ï¼‰","Scarlet Lance","æ˜Ÿæ²³ä¸€å¤©","æ†æ‚ªã¨é†œæ‚ªã®èŠ±æŸï¼ˆè¡¨ï¼‰","Destr0yerï¼ˆè£ï¼‰","ãƒ‰ãƒ‰ãƒ‰ãƒ‰ãƒ‰ãƒ³ã ãƒ•ãƒ«ï¼ï¼ˆè£ï¼‰","ã¯ãŸãƒ©ã‚¯2000","Vixtoryï¼ˆè¡¨ï¼‰","ç§˜ãƒŠãƒ«ãƒ¡ã‚¸ã‚§ãƒ‰ãƒæ‚²ãƒŠãƒ«æ†‚é¬±","ãƒ¡ã‚¿ãƒ«ãƒ›ãƒ¼ã‚¯ BGM1","memoria ficta","ç‡åŸãƒèˆ","æ„›ã¨æµ„ç½ªã®æ£®","ã‚¢ã‚µã‚¬ã‚ª","Abyss of hellï¼ˆè£ï¼‰","å¤©ç…§","Ignis Danse","Illusion Flare","ã†ã¡ã‚…ã†ã²ã“ã†ã—å†’é™ºè­š","exå¯… Trap!!","Evidence of evil","ã‚«ãƒ©é ã®èŠ±","ã‚®ã‚¬ãƒ³ãƒ†ã‚£ãƒƒã‚¯O.T.Nï¼ˆè£ï¼‰","ãã‚…ã†ãã‚‰ã‚Šã‚“ï¼ˆè£ï¼‰","å…±å¥é¼“ç¥­ï¼ˆè£ï¼‰","Chronomia","å¼§","ã‚´ãƒ¼ã‚¹ãƒˆãƒã‚¹ã‚¯","ã‚´ãƒƒãƒ‰ã‚½ãƒ³ã‚°ï¼ˆè£ï¼‰","God Ray","é¼“èˆæ›²ã€Œé–»é­”ã€","æ½®é¨’205å·SSSç·š","ç´«ç…Œãƒä¹±","è›‡é‰„","é ˆä½ä¹‹ç”·","Spectral Rider","Soulwayï¼ˆé”äººï¼‰","D's Adventure Note","Dçµ¶å¯¾ï¼SAMURAIã‚¤ãƒ³ã‚¶ãƒ¬ã‚¤ãƒ³ï¼ˆè£ï¼‰","Telecastic fake show","ã¦ã‚“ã¢ã2000","å¼©èšŠæ€’å¤","ã¨ã‘ã‚‹ï¼ˆè¡¨ï¼‰","Dogbite","Doppelgangersï¼ˆè£ï¼‰","ç™½é³¥ã®æ¹–ï½still a ducklingï½ï¼ˆè£ï¼‰","ãƒãƒ³ãƒ­ãƒƒã‚¯","å¹³ç­‰é™¢é³³å‡°ãƒ‰ãƒ³ vs é³¥ç£æˆ¯ã‚«ãƒƒï¼ˆè£ï¼‰","ãƒ˜ã‚¤ãƒ©ï¼ˆè£ï¼‰","ãƒ˜ã‚¤ãƒ©ï¼ˆã«ã˜ã•ã‚“ã˜Ver.ï¼‰ï¼ˆè£ï¼‰","ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—å¤§æˆ¦","MagiCatz","ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒ»ãƒªãƒœãƒ«ãƒãƒ¼ï¼ˆè£ï¼‰","YOU're your HERO","å…­è¯ã®èˆ","wonderful ROUTINE","ã‚ã®æ—¥å‡ºä¼šãˆãŸã‚­ã‚»ã‚­","ã‚¢ãƒ³ãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚²ãƒ¼ãƒ ã‚ºï¼ˆè¡¨ï¼‰","ã‚®ãƒŸãƒãƒ§ã‚³!!ï¼ˆè£ï¼‰","Gloria","æ¿ƒç´…","æ¿ƒç´…ï¼ˆã«ã˜ã•ã‚“ã˜Ver.ï¼‰","ã‚³ã‚³ãƒ­ãƒœ","Central Dogma Pt.1ï¼ˆè¡¨ï¼‰","å¤ç¥­ã‚Š / ã‚¸ãƒƒã‚¿ãƒªãƒ³ãƒ»ã‚¸ãƒ³ï¼ˆè£ï¼‰","Purple Rose Fusion","ã¿ã‚“ãªã®ã†ãŸ","MEGALOVANIAï¼ˆè£ï¼‰","4+1ã®ãã‚Œãã‚Œã®æœªæ¥","Lightning Boysï¼ˆè¡¨ï¼‰","ã‚¢ã‚­ãƒ20XX","Aloft in the windï¼ˆè£ï¼‰","ã‚¤ã‚¬ã‚¯ï¼ˆè£ï¼‰","é ‚","INSPION","ã‚¦ã‚£ãƒ¼ã‚¢ãƒ¼ï¼ï¼ˆè£ï¼‰","waitin' for u","Angel Halo","ã‚ªãƒ¼ãƒãƒ¼ãƒ‰ï¼ˆè£ï¼‰","ã‚ªãƒ¼ãƒ–ã®ç¥ˆã‚Š","Oshama Scramble!ï¼ˆè£ï¼‰","GIGALODOONï¼ˆè¡¨ï¼‰","ããŸã•ã„ãŸã¾2000","ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«ãƒ»ã‚¸ãƒ£ãƒ³ã‚­ãƒ°","Surf Zapping","Silent Jealousyï¼ˆè£ï¼‰","ã‚»ã‚¤ã‚¯ãƒªãƒƒãƒ‰ ãƒ«ã‚¤ãƒ³ï¼ˆè£ï¼‰","é›¶ã®äº¤éŸ¿æ›²ï¼ˆè£ï¼‰","ãã¤ãŠã‚ã—ã2ã°ã‚“","åéœ²ç›¤2000","Diving Drive","ãƒ€ãƒ³ã‚¬ãƒ³ãƒãƒ¼ãƒ„ï¼ˆè¡¨ï¼‰","å¤©ä¸‹çµ±ä¸€éŒ²","ãƒ‰ãƒ‰ãƒ³ã‚¬ãƒ‰ï½ãƒ³ï¼ˆè£ï¼‰","No Gravity","ãƒã‚‹ã©ã‚“2000","VICTORIA","ãƒ”ã‚³ãƒ”ã‚³ ãƒ«ã‚¤ãƒ³ï¼ˆè£ï¼‰","VIVIVIVID","FREEDOM DiVEâ†“","Venomousï¼ˆè£ï¼‰","æ˜Ÿå±‘ã‚¹ãƒˆãƒ©ãƒƒã‚¯ï¼ˆè¡¨ï¼‰","8OROCHIï¼ˆè¡¨ï¼‰","YOAKE","å¤œæ¡œè¬è‚‰ç¥­ï¼ˆè£ï¼‰","ãƒ©ãƒ´â™¡ã‚¹ãƒ‘ã‚¤ã‚¹â™¡ãƒ©ã‚¤ã‚¯ãƒ¦ãƒ¼!!!","Libera Ray","è©©è¬³å…æºè•©å…","Extreme End","Emmaï¼ˆè£ï¼‰[æ™®é€š]","Garakuta Doll Playï¼ˆè£ï¼‰ã€åŒæ‰“ã€‘","ã‚´ãƒ¼ã‚´ãƒ¼ãƒ»ã‚­ãƒƒãƒãƒ³ï¼ˆè£ï¼‰","æœ€çµ‚é¬¼ç•œå¦¹ãƒ•ãƒ©ãƒ³ãƒ‰ãƒ¼ãƒ«ãƒ»S","ã‚¿ã‚¤ã‚³ã‚¿ã‚¤ãƒ ï¼ˆè£ï¼‰","ä¹±æ•°èª¿æ•´ã®ãƒªãƒãƒ¼ã‚¹ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©ï¼ˆè£ï¼‰","R.I.","è’¼ã®æ—‹å¾‹ï¼ˆè£ï¼‰","æœ±ã®æ—‹å¾‹","EkiBEN2000","Kamikaze Remix","Calamity Fortuneï¼ˆè¡¨ï¼‰","ã‚­ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼â˜†ãƒ‡ãƒ¢ãƒ‹ãƒƒã‚¯â˜†é­”äººã‚¨ãƒ¢!!","ã€åŒæ‰“ã€‘ç´…ï¼ˆè£ï¼‰","ã•ã¡ã•ã¡ã«ã—ã¦ã‚ã’ã‚‹â™ªï¼ˆè£ï¼‰","ã‚¹ãƒ¼ãƒ‘ãƒ¼Dï¼†D ï½å®Œå…¨ã«ãƒªãƒ¼ãƒ‰ã—ã¦ã‚¢ã‚¤ãƒã‚¤ãƒŸãƒ¼ï½","SUPERNOVAï¼ˆè¡¨ï¼‰","SstTAarR*","Soulwayï¼ˆé–‹å¹•æ™®é€šï¼‰","ã‚¿ã‚¤ã‚³ãƒ­ãƒ¼ãƒ«","ã‚¿ãƒ™ãƒ«ãƒŠ2000","å„šå§«ã¯åŸåˆã«èˆã†ï¼ˆè¡¨ï¼‰","BATTLE NO.1[ç„äºº]","ãƒ’ãƒãƒŠï¼ˆè£ï¼‰","Blessed Bouquet Buskers","ã‚ˆãƒ¼ã„ãƒ‰ãƒ³ï¼","ãã¤ãŠã‚ã—ã","åˆéŸ³ãƒŸã‚¯ã®æ¿€å”±ï¼ˆè¡¨ï¼‰","åˆéŸ³ãƒŸã‚¯ã®æ¿€å”±ï¼ˆè£ï¼‰","ãƒ‘ãƒ³ vs ã”ã¯ã‚“ï¼ å¤§æ±ºæˆ¦ï¼ï¼ˆè¡¨ï¼‰[æ™®é€š]","ãƒ‘ãƒ³ vs ã”ã¯ã‚“ï¼ å¤§æ±ºæˆ¦ï¼ï¼ˆè£ï¼‰[æ™®é€š]","Black Rose Apostleï¼ˆè¡¨ï¼‰","Black Rose Apostleï¼ˆè£ï¼‰","ãƒãƒ„ãƒ¨ã‚¤ãƒŠã‚¤ãƒˆãƒã‚°ï¼ˆè£ï¼‰","X-DAY2000","KAGEKIYOï¼ˆè£ï¼‰ã€åŒæ‰“ã€‘","Clotho ã‚¯ãƒ­ãƒ¼ãƒˆãƒ¼","æ—‹é¢¨ãƒèˆã€å¤©ã€‘ï¼ˆè¡¨ï¼‰","æ—‹é¢¨ãƒèˆã€å¤©ã€‘ï¼ˆè£ï¼‰","ãƒãƒ«ãƒã®ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã•ã‚“ã™ã†æ•™å®¤ï¼ˆè£ï¼‰","ãƒã‚¯ãƒ­ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ã‚¢ ï½ Arr.Demetori","æ‹å•“ãƒ‰ãƒƒãƒšãƒ«ã‚²ãƒ³ã‚¬ãƒ¼","BATTLE NO.1[æ™®é€š]","mint tears"
            ],
            'hard': [
                "Infinite Rebellion","å½ï¼ˆè£ï¼‰","CRUXNAUT","The Future of the å¤ªé¼“ãƒ‰ãƒ©ãƒ ï¼ˆè£ï¼‰","ç¥ç«œ ï½Shinryuï½ï¼ˆè£ï¼‰","æ†æ‚ªã¨é†œæ‚ªã®èŠ±æŸï¼ˆè£ï¼‰","ãƒ€ãƒ¼ã‚¯ãƒ»ã‚¨ã‚¯ã‚¹ãƒ»ãƒã‚­ãƒŠâ™¡","ç¬¬å…­å¤©é­”ç‹ï¼ˆè¡¨ï¼‰","ç¬¬å…­å¤©é­”ç‹ï¼ˆè£ï¼‰","ãƒ€ãƒ³ã‚¬ãƒ³ãƒãƒ¼ãƒ„ï¼ˆè£ï¼‰","Destination 2F29","ãƒ‰ãƒ³ã‚«ãƒ2000","23æ™‚54åˆ†ã€é™½ã®æ—…è·¯ã¸ã®ãƒ—ãƒ¬ãƒªãƒ¥ãƒ¼ãƒ‰ï¼ˆè£ï¼‰","Vixtoryï¼ˆè£ï¼‰","vs.VIGVANGSï¼ˆè£ï¼‰","poxeiâ™¦DOON","å¹½ç„ãƒä¹±","!!!ã‚«ã‚ªã‚¹ã‚¿ã‚¤ãƒ !!!","â€ â€ â€ ã‚«ã‚ªã‚¹ã‚¿ã‚¤ãƒ  the DARKâ€ â€ â€ ","Calamity Fortuneï¼ˆè£ï¼‰","æ¥­ -å–„ãªã‚‹ç¥ã¨ã“ã®ä¸–ã®æ‚ªã«ã¤ã„ã¦-ï¼ˆè£ï¼‰","æœ€æœã®é­”æ³•ä½¿ã„ï¼ˆè£ï¼‰","siren's eye","ç–¾é¢¨æ€’æ¿¤ï¼ˆè£ï¼‰","Central Dogma Pt.1ï¼ˆè£ï¼‰","é­‘é­…é­é­","ã¨ã‘ã‚‹ï¼ˆè£ï¼‰","ãƒˆãƒ­ã„ã‹2000","ãƒ©ãƒ»ãƒ¢ãƒ¬ãƒ¼ãƒŠãƒ»ã‚¯ãƒ¢ãƒŠã‚¤ï¼ˆè£ï¼‰","ã‚¢ãƒ³ãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚²ãƒ¼ãƒ ã‚ºï¼ˆè£ï¼‰","Emmaï¼ˆè£ï¼‰[é”äºº]","CUT! into the FUTUREï¼ˆè£ï¼‰","åˆ»ç«œ ï½Kokuryuï½ï¼ˆè£ï¼‰","!!!ãƒãƒ«ãƒã®ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã•ã‚“ã™ã†ã‚¿ã‚¤ãƒ !!!","ã¾ã ã•ã„ãŸã¾2000","4+1ã®ãã‚Œãã‚Œã®æœªæ¥ï¼ˆè£ï¼‰[é”äºº]","4+1ã®ãã‚Œãã‚Œã®æœªæ¥ï¼ˆè£ï¼‰[ç„äºº]","4+1ã®ãã‚Œãã‚Œã®æœªæ¥ï¼ˆè£ï¼‰[æ™®é€š]","ã‚ªãƒšãƒ¬ãƒ¼ãƒˆãƒ»ãƒŸãƒ¼ï¼ˆè£ï¼‰","å½ï¼ˆè¡¨ï¼‰","ä»®æƒ³ç¾å®Ÿã®ãƒ†ãƒ¬ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆè£ï¼‰","Coquette","Synthesis.ï¼ˆè£ï¼‰","ã‚¹ãƒ¼ãƒãƒ¼2000","ç¶šãƒ»ã€†ãƒ‰ãƒ¬ãƒ¼2000","ãã—ã¦å‹‡è€…ã¯çœ ã‚Šã«ã¤ãï¼ˆè£ï¼‰","Taiko Drum Monsterï¼ˆè£ï¼‰","Challengers","â‰ ï¼­ï¼­","Hurtling Boys","åˆéŸ³ãƒŸã‚¯ã®æ¶ˆå¤±â€åŠ‡å ´ç‰ˆâ€ï¼ˆè£ï¼‰","æ˜Ÿå±‘ã‚¹ãƒˆãƒ©ãƒƒã‚¯ï¼ˆè£ï¼‰","Lightning Boysï¼ˆè£ï¼‰","LÎ´chesisï¼ˆè£ï¼‰","Î»7708","ã‚ã‚‰å¾—ã‚‹2000","Xaï¼ˆè£ï¼‰","ç‹‚ç€¾æ€’æ¿¤ï¼ˆè£ï¼‰","æ°·ç«œï½Kooryuï½ï¼ˆè£ï¼‰","Genesis Rayï¼ˆè£ï¼‰","åŒç«œãƒä¹±","ãŸã„ã“ã®2000","ãƒãƒ£ãƒ¼ãƒªãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ï¼","Nosferatuï¼ˆè£ï¼‰","POLARiSNAUT","ãƒ¢ãƒã‚¯ãƒ­ãƒœã‚¤ã‚¹ï¼ˆè£ï¼‰","UFO Swingin'"
            ]
        };

        const requestWakeLock = async () => {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {});
                }
            } catch (err) { console.error(err); }
        };
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') await requestWakeLock();
        });

        const handleUnload = () => {
            if (currentRoomId && currentUser) deleteDoc(doc(db, "rooms", currentRoomId)).catch(()=>{});
            if (waitingDocId) deleteDoc(doc(db, "waiting_room", waitingDocId)).catch(()=>{});
        };
        window.addEventListener('beforeunload', handleUnload);

        window.setViewMode = (mode) => {
            const container = document.getElementById('main-container');
            const btnMobile = document.getElementById('btn-mobile');
            const btnPc = document.getElementById('btn-pc');
            if (mode === 'pc') {
                container.classList.remove('mobile-mode'); container.classList.add('pc-mode');
                btnMobile.classList.remove('active'); btnPc.classList.add('active');
                localStorage.setItem('view_mode', 'pc');
            } else {
                container.classList.remove('pc-mode'); container.classList.add('mobile-mode');
                btnMobile.classList.add('active'); btnPc.classList.remove('active');
                localStorage.setItem('view_mode', 'mobile');
            }
        };
        const savedMode = localStorage.getItem('view_mode');
        if (savedMode) window.setViewMode(savedMode);
        else window.setViewMode('mobile');

        window.loginAnon = () => signInAnonymously(auth).catch(e => alert(e.message));
        window.loginWithGoogle = () => signInWithPopup(auth, new GoogleAuthProvider()).catch(e => alert(e.message));
        window.loginWithEmail = async () => {
            const email = document.getElementById('email-input').value;
            const pass = document.getElementById('pass-input').value;
            if(!email || !pass) return alert("å…¥åŠ›ã—ã¦ãã ã•ã„");
            try { await signInWithEmailAndPassword(auth, email, pass); }
            catch(e) { try { await createUserWithEmailAndPassword(auth, email, pass); } catch(e2) { alert(e2.message); } }
        };

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                currentUser = user;
                try {
                    const userRef = doc(db, "users", user.uid);
                    const userSnap = await getDoc(userRef);
                    if (userSnap.exists()) {
                        userData = userSnap.data();
                        if(userData.rate === undefined) userData.rate = 1500;
                    } else {
                        userData = { displayName: "åç„¡ã—ã©ã‚“", xId: "æœªè¨­å®š", rate: 1500, createdAt: new Date() };
                        await setDoc(userRef, userData);
                    }
                    updateProfileUI();
                    switchScreen('title-screen');
                    
                    const savedRoomId = localStorage.getItem('current_room_id');
                    if (savedRoomId) checkRestore(savedRoomId);
                } catch(e) { console.error(e); switchScreen('title-screen'); }
            }
        });

        const updateProfileUI = () => {
            document.getElementById('display-name').innerText = userData.displayName;
            document.getElementById('display-xid').innerText = userData.xId;
            document.getElementById('display-rate').innerText = userData.rate;
            document.getElementById('edit-name').value = userData.displayName;
            document.getElementById('edit-xid').value = userData.xId;
        };

        window.openProfileModal = () => document.getElementById('profile-modal').style.display = 'flex';
        window.saveProfile = async () => {
            const newName = document.getElementById('edit-name').value;
            const newXid = document.getElementById('edit-xid').value;
            if(!newName) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            await setDoc(doc(db, "users", currentUser.uid), { displayName: newName, xId: newXid || "æœªè¨­å®š" }, { merge: true });
            userData.displayName = newName; userData.xId = newXid || "æœªè¨­å®š";
            updateProfileUI(); closeModal('profile-modal');
        };

        window.openRanking = async () => {
            document.getElementById('ranking-modal').style.display = 'flex';
            const tbody = document.getElementById('ranking-list');
            tbody.innerHTML = '<tr><td colspan="3">èª­ã¿è¾¼ã¿ä¸­...</td></tr>';
            try {
                const q = query(collection(db, "users"), orderBy("rate", "desc"), limit(10));
                const snapshot = await getDocs(q);
                tbody.innerHTML = "";
                let rank = 1;
                snapshot.forEach(doc => {
                    const d = doc.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td class="rank-${rank}">${rank}</td><td style="text-align:left;">${d.displayName || 'åç„¡ã—'}</td><td>${d.rate || 1500}</td>`;
                    tbody.appendChild(tr);
                    rank++;
                });
            } catch(e) { tbody.innerHTML = '<tr><td colspan="3">èª­ã¿è¾¼ã¿å¤±æ•—</td></tr>'; }
        };

        window.tryStartMatching = (mode) => {
            if (userData.xId === "æœªè¨­å®š" || !userData.xId.startsWith("@")) {
                alert("ã€è¨­å®šã‚¨ãƒ©ãƒ¼ã€‘\nX IDã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚");
                openProfileModal(); return;
            }
            startMatching(mode);
        };

        const switchScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        };
        window.closeModal = (id) => document.getElementById(id).style.display = 'none';

        const checkRestore = async (roomId) => {
             try {
                 const roomSnap = await getDoc(doc(db, "rooms", roomId));
                 if(roomSnap.exists()) {
                     requestWakeLock();
                     startHeartbeat(roomId);
                     watchRoom(roomId);
                 } else {
                     localStorage.removeItem('current_room_id');
                 }
             } catch(e) { localStorage.removeItem('current_room_id'); }
        };

        const pickRandomSongs = (mode) => {
            const list = songDatabase[mode] || [];
            return [...list].sort(() => 0.5 - Math.random()).slice(0, 3);
        };

        const startMatching = async (mode) => {
            switchScreen('matching-screen');
            document.getElementById('match-status').innerText = "å¯¾æˆ¦ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...";
            try {
                // å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³: 12ç§’ä»¥ä¸Šå¾…ã£ã¦ã„ã‚‹äººã¨ã¯ãƒãƒƒãƒã—ãªã„
                // ã‚´ãƒ¼ã‚¹ãƒˆé€€æ²»: 15ç§’ä»¥ä¸Šå¤ã„ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤
                const q = query(collection(db, "waiting_room"), where("mode", "==", mode), limit(20));
                const snap = await getDocs(q);
                let opponentDoc = null;
                const now = Date.now();

                for (const d of snap.docs) {
                    const data = d.data();
                    const elapsed = data.createdAt ? (now - data.createdAt.toMillis()) : 99999;
                    
                    if (elapsed > 15000) {
                        deleteDoc(doc(db, "waiting_room", d.id)).catch(()=>{});
                        continue; 
                    }
                    // â˜…å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³: 12ç§’ä»¥ä¸ŠçµŒéã—ã¦ã„ã‚‹ç›¸æ‰‹ã¯ã‚¹ã‚­ãƒƒãƒ—
                    if (elapsed > 12000) {
                        continue;
                    }

                    if(data.uid !== currentUser.uid) {
                        opponentDoc = d;
                        break;
                    }
                }

                if(opponentDoc) {
                    const opp = opponentDoc.data();
                    await deleteDoc(doc(db, "waiting_room", opponentDoc.id));
                    const roomRef = await addDoc(collection(db, "rooms"), {
                        mode: mode, songs: pickRandomSongs(mode), createdAt: new Date(),
                        player1: { uid: opp.uid, xId: opp.xId, displayName: opp.displayName, result: null, lastSeen: Date.now() },
                        player2: { uid: currentUser.uid, xId: userData.xId, displayName: userData.displayName, result: null, lastSeen: Date.now() }
                    });
                    localStorage.setItem('current_room_id', roomRef.id);
                    requestWakeLock();
                    startHeartbeat(roomRef.id);
                    watchRoom(roomRef.id);
                } else {
                    const ref = await addDoc(collection(db, "waiting_room"), {
                        uid: currentUser.uid, mode: mode, xId: userData.xId, displayName: userData.displayName, 
                        rate: userData.rate, createdAt: new Date()
                    });
                    waitingDocId = ref.id;
                    
                    if(matchTimer) clearTimeout(matchTimer);
                    matchTimer = setTimeout(async () => {
                        if(waitingDocId) {
                            if(unsubscribeRoom) unsubscribeRoom();
                            unsubscribeRoom = null;
                            try { await deleteDoc(doc(db, "waiting_room", waitingDocId)); } catch(e){}
                            waitingDocId = null;
                            switchScreen('title-screen');
                            alert("ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€‘\nä¸€å®šæ™‚é–“ãƒãƒƒãƒãƒ³ã‚°ã—ãªã‹ã£ãŸãŸã‚ã€\nè‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚");
                        }
                    }, 15000); 

                    const roomQ = query(collection(db, "rooms"), where("player1.uid", "==", currentUser.uid));
                    unsubscribeRoom = onSnapshot(roomQ, snap => {
                        snap.docChanges().forEach(c => {
                            if(c.type === "added") {
                                if(matchTimer) clearTimeout(matchTimer); 
                                waitingDocId = null; unsubscribeRoom();
                                localStorage.setItem('current_room_id', c.doc.id);
                                requestWakeLock();
                                startHeartbeat(c.doc.id);
                                watchRoom(c.doc.id);
                            }
                        });
                    });
                }
            } catch(e) { console.error(e); alert("ãƒãƒƒãƒãƒ³ã‚°ã‚¨ãƒ©ãƒ¼"); switchScreen('title-screen'); }
        };

        const startHeartbeat = (roomId) => {
            if(heartbeatTimer) clearInterval(heartbeatTimer);
            updateLastSeen(roomId);
            heartbeatTimer = setInterval(() => {
                if(!currentRoomId) return;
                updateLastSeen(roomId);
            }, 5000); 
        };

        const updateLastSeen = async (roomId) => {
            if(currentMatchData.isP1 !== undefined) {
                const field = currentMatchData.isP1 ? "player1.lastSeen" : "player2.lastSeen";
                try { await updateDoc(doc(db, "rooms", roomId), { [field]: Date.now() }); } catch(e) {}
            }
        }

        const watchRoom = (roomId) => {
            currentRoomId = roomId;
            isFinalizing = false;
            unsubscribeRoom = onSnapshot(doc(db, "rooms", roomId), (docSnap) => {
                if(!docSnap.exists()) {
                    handleForceExit("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n(ç›¸æ‰‹ã®é€šä¿¡åˆ‡æ–­ã€ã¾ãŸã¯é€€å‡º)");
                    return;
                }
                const data = docSnap.data();
                const isP1 = data.player1.uid === currentUser.uid;
                const me = isP1 ? data.player1 : data.player2;
                const opponent = isP1 ? data.player2 : data.player1;
                
                currentMatchData = { me, opponent, songs: data.songs, isP1 };

                // â˜… åˆ‡æ–­æ¤œçŸ¥ (780ç§’ = 13åˆ†)
                const now = Date.now();
                if (opponent.lastSeen && (now - opponent.lastSeen > 780000)) { 
                    deleteDoc(doc(db, "rooms", roomId)).catch(()=>{});
                    return; 
                }

                if (me.result && opponent.result) {
                    if (!isFinalizing) {
                        isFinalizing = true;
                        checkAndFinalize(data.player1.result, data.player2.result, isP1);
                    }
                } else if (me.result && !opponent.result) {
                    if (!document.getElementById('waiting-result-screen').classList.contains('active')) {
                        switchScreen('waiting-result-screen');
                    }
                } else {
                    const isGaming = document.getElementById('reveal-screen').classList.contains('active') ||
                                     document.getElementById('report-screen').classList.contains('active');
                    
                    if (document.getElementById('waiting-result-screen').classList.contains('active')) {
                        goToReportScreen();
                    } else if (!isGaming) {
                        startReveal(opponent, data.songs);
                    }
                }
            });
        };

        const handleForceExit = (msg) => {
            if(heartbeatTimer) clearInterval(heartbeatTimer);
            if(wakeLock) wakeLock.release().then(()=> wakeLock = null).catch(()=>{});
            localStorage.removeItem('current_room_id');
            alert(msg);
            location.reload();
        };

        const startReveal = async (opponent, songs) => {
            switchScreen('reveal-screen');
            document.getElementById('opponent-x-display').innerText = `${opponent.displayName}\n(${opponent.xId})`;
            const con = document.getElementById('song-reveal-container');
            con.innerHTML = "";
            for(let i=0; i<songs.length; i++){
                await new Promise(r=>setTimeout(r, 400));
                const d = document.createElement('div');
                d.style.cssText = "background:#fff3e0; border:2px solid #ff9800; padding:10px; margin:5px 0; border-radius:8px; font-weight:bold; opacity:0; transform:translateX(-10px); transition:0.3s;";
                d.innerHTML = `<span style="background:#ff5722; color:white; padding:2px 5px; border-radius:4px; font-size:0.8rem; margin-right:5px;">${i+1}</span> ${songs[i]}`;
                con.appendChild(d);
                setTimeout(()=> { d.style.opacity=1; d.style.transform="translateX(0)"; }, 50);
            }
            document.getElementById('goto-report-btn').style.display = 'inline-block';
        };

        window.goToReportScreen = () => {
            switchScreen('report-screen');
            document.getElementById('rep-opp-name').innerText = currentMatchData.opponent.displayName;
            document.getElementById('rep-opp-xid').innerText = currentMatchData.opponent.xId;
            const listContainer = document.getElementById('rep-song-list');
            listContainer.innerHTML = "";
            currentMatchData.songs.forEach((song, i) => {
                const item = document.createElement('div');
                item.className = "song-list-item";
                item.innerText = `${i+1}. ${song}`;
                listContainer.appendChild(item);
            });
        };

        window.confirmResult = (res) => {
            selectedResult = res;
            const map = { 'WIN':'å‹ã¡', 'LOSE':'è² ã‘', 'DRAW':'å¼•åˆ†' };
            document.getElementById('modal-selection').innerText = map[res];
            document.getElementById('confirm-modal').style.display = 'flex';
        };

        window.submitResult = async () => {
            closeModal('confirm-modal');
            switchScreen('waiting-result-screen');
            const field = currentMatchData.isP1 ? "player1.result" : "player2.result";
            isFinalizing = false; 
            try {
                await updateDoc(doc(db, "rooms", currentRoomId), { [field]: selectedResult });
            } catch(e) { console.error(e); switchScreen('report-screen'); }
        };

        const checkAndFinalize = async (p1Res, p2Res, amIP1) => {
            const myRes = amIP1 ? p1Res : p2Res;
            const oppRes = amIP1 ? p2Res : p1Res;
            let valid = false;
            if ((myRes === 'WIN' && oppRes === 'LOSE') ||
                (myRes === 'LOSE' && oppRes === 'WIN') ||
                (myRes === 'DRAW' && oppRes === 'DRAW')) {
                valid = true;
            }

            if (valid) {
                if(unsubscribeRoom) unsubscribeRoom();
                if(heartbeatTimer) clearInterval(heartbeatTimer);
                if(wakeLock) wakeLock.release().catch(()=>{});
                
                const currentRate = Number(userData.rate) || 1500;
                let newRate = currentRate;
                let diff = 0;
                if(myRes === 'WIN') diff = 20;
                if(myRes === 'LOSE') diff = -20;
                newRate = currentRate + diff;
                try {
                    await setDoc(doc(db, "users", currentUser.uid), { rate: newRate }, { merge: true });
                    userData.rate = newRate; 
                } catch (e) {}
                showFinalResult(myRes, diff, newRate);
            } else {
                isFinalizing = false;
                document.getElementById('error-modal').style.display = 'flex';
            }
        };

        window.retryReport = async () => {
            document.getElementById('error-modal').style.display = 'none';
            const field = currentMatchData.isP1 ? "player1.result" : "player2.result";
            try { await updateDoc(doc(db, "rooms", currentRoomId), { [field]: null }); } catch(e){}
            goToReportScreen();
        };

        const showFinalResult = (result, diff, currentRate) => {
            switchScreen('final-result-screen');
            const title = document.getElementById('final-title');
            const diffEl = document.getElementById('anim-rate-diff');
            
            if(result === 'WIN') {
                title.innerText = "YOU WIN!"; title.style.color = "#e91e63";
                diffEl.innerText = "+" + diff; diffEl.style.color = "#e91e63";
            } else if(result === 'LOSE') {
                title.innerText = "YOU LOSE..."; title.style.color = "#2196f3";
                diffEl.innerText = diff; diffEl.style.color = "#2196f3";
            } else {
                title.innerText = "DRAW"; title.style.color = "#9c27b0";
                diffEl.innerText = "Â±0"; diffEl.style.color = "#9c27b0";
            }
            document.getElementById('anim-rate-val').innerText = currentRate;
            setTimeout(() => diffEl.classList.add('show'), 500);
        };

        window.tryExitRoom = () => {
            document.getElementById('exit-confirm-modal-1').style.display = 'flex';
        };
        window.showExitConfirm2 = () => {
            document.getElementById('exit-confirm-modal-1').style.display = 'none';
            document.getElementById('exit-confirm-modal-2').style.display = 'flex';
        };
        window.forceExitRoom = async () => {
            if (currentRoomId) {
                try { await deleteDoc(doc(db, "rooms", currentRoomId)); } catch(e){}
            }
            if(heartbeatTimer) clearInterval(heartbeatTimer);
            if(wakeLock) wakeLock.release().catch(()=>{});
            localStorage.removeItem('current_room_id');
            location.reload();
        };

        window.returnToTitle = async () => {
            if (currentRoomId) {
                try { await deleteDoc(doc(db, "rooms", currentRoomId)); } catch(e){}
            }
            if(heartbeatTimer) clearInterval(heartbeatTimer);
            if(wakeLock) wakeLock.release().catch(()=>{});
            localStorage.removeItem('current_room_id');
            location.reload();
        };

        window.cancelMatching = async () => {
            if(matchTimer) clearTimeout(matchTimer); 
            localStorage.removeItem('current_room_id');
            if(waitingDocId) await deleteDoc(doc(db, "waiting_room", waitingDocId));
            switchScreen('title-screen');
        };
    </script>
</body>
</html>
